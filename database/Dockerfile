FROM  postgres:14-alpine
LABEL maintainer="ezemango@gmail.com"
ARG   DB_USER
ARG   DB_PASSWORD
ARG   DB_NAME
ARG   BACKEND_DB_USER
ARG   BACKEND_DB_PASSWORD
ARG   STORAGE_DB_USER
ARG   STORAGE_DB_PASSWORD
RUN   echo " \
        CREATE ROLE ${DB_USER} WITH LOGIN CREATEDB PASSWORD '${DB_PASSWORD}'; \
        CREATE DATABASE ${DB_NAME}; \
        GRANT ALL PRIVILEGES ON DATABASE ${DB_NAME} TO ${DB_USER}; \
        CREATE ROLE ${BACKEND_DB_USER} WITH LOGIN PASSWORD '${BACKEND_DB_PASSWORD}'; \
        CREATE DATABASE ${BACKEND_DB_USER}; \
        GRANT CONNECT ON DATABASE ${DB_NAME} TO ${BACKEND_DB_USER}; \
        CREATE ROLE ${STORAGE_DB_USER} WITH LOGIN PASSWORD '${STORAGE_DB_PASSWORD}'; \
        CREATE DATABASE ${STORAGE_DB_USER}; \
        GRANT CONNECT ON DATABASE ${DB_NAME} TO ${STORAGE_DB_USER}; \
        " > /docker-entrypoint-initdb.d/set_user.sql
